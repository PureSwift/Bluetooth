---
addons:
  apt:
    packages:
      - clang
      - pkg-config
      - git
      - curl
before_install:
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then sudo apt-get update -y ; fi"
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then sudo apt-get install clang git curl ; fi"
language: generic
matrix:
  include:
    -
      os: osx
      osx_image: xcode11.4
    -
      os: osx
      osx_image: xcode12
    -
      arch: amd64
      dist: xenial
      install:
        - SWIFT_VERSION=swift-5.2.2-RELEASE
        - "SWIFT_URL=https://swift.org/builds/swift-5.2.2-release/ubuntu1604/swift-5.2.2-RELEASE/swift-5.2.2-RELEASE-ubuntu16.04.tar.gz"
        - SWIFT_DIR=tests
        - "mkdir $SWIFT_DIR"
        - "curl $SWIFT_URL -s | tar xz -C $SWIFT_DIR &> /dev/null"
        - "export PATH=$(pwd)/tests/$SWIFT_VERSION-ubuntu16.04/usr/bin:\"${PATH}\""
      os: linux
      sudo: required
    -
      arch: arm64
      dist: buster
      install:
        - "curl -s https://packagecloud.io/install/repositories/swift-arm/release/script.deb.sh | sudo bash"
        - "sudo apt install -y swiftlang"
      os: linux
      sudo: required
script:
  - "uname -a"
  - "swift --version"
  - "swift test"
