--- 
addons: 
  apt: 
    packages: 
      - clang
      - pkg-config
arch: 
  - amd64
  - arm64
before_install: 
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then sudo apt-get update -y ; fi"
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then sudo apt-get install clang ; fi"
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" && \"$TRAVIS_CPU_ARCH\" == \"arm64\" ]]; then curl -s https://packagecloud.io/install/repositories/swift-arm/release/script.deb.sh | sudo bash ; fi"
  - "if [[ \"$TRAVIS_OS_NAME\" == \"linux\" && \"$TRAVIS_CPU_ARCH\" == \"arm64\" ]]; then sudo apt install -y swiftlang ; fi"
language: generic
matrix: 
  include: 
    - 
      arch: amd64
      dist: xenial
      env: 
        - SWIFT_VERSION=swift-5.2.2-RELEASE
        - "SWIFT_URL=https://swift.org/builds/swift-5.2.2-release/ubuntu1604/swift-5.2.2-RELEASE/swift-5.2.2-RELEASE-ubuntu16.04.tar.gz"
        - SWIFT_DIR=tests
      install: 
        - SWIFT_DIR=tests
        - "mkdir $SWIFT_DIR"
        - "curl $SWIFT_URL -s | tar xz -C $SWIFT_DIR &> /dev/null"
        - "export PATH=$(pwd)/tests/$SWIFT_VERSION-ubuntu16.04/usr/bin:\"${PATH}\""
      os: linux
      sudo: required
    - 
      arch: arm64
      dist: buster
      install: 
        - "sudo apt install -y swiftlang"
      os: linux
      sudo: required
os: 
  - osx
  - linux
script: 
  - "swift test"
